(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{1:function(e,t,r){"use strict";t.a={TYPE_ERR:0,TYPE_TEXT:1,TYPE_HTML:2,TYPE_JSON:3,TYPE_XML:4,TYPE_FEED:5,TYPE_FORM:6,TYPE_PDF_HTML:7,TYPE_DOC:8,TYPE_RULE:1,TYPE_RULE_GROUP:2,OP_AND:1,OP_OR:2,CONTENT_TYPE_TEXT:1,CONTENT_TYPE_CHANGED_TEXT:2,CONTENT_TYPE_OLD_TEXT:3,RULE_NOT_EMPTY:1,RULE_HAS_TEXT:2,RULE_HAS_TEXT_NOT:3,RULE_HAS_NUMBER_LT:4,RULE_HAS_NUMBER_GT:5,RULE_HAS_NUMBER_DECR_MIN:6,RULE_HAS_NUMBER_INCR_MIN:7,RULE_MATCH_REGEX:8,RULE_HAS_NUMBER_DECR_PERCENT_MIN:9,RULE_HAS_NUMBER_INCR_PERCENT_MIN:10,STATE_DEFAULT:0,STATE_NEW:10,STATE_INIT:20,STATE_UNAUTHORIZED:30,STATE_AUTHORIZED:35,STATE_READY:40,STATE_PAUSED:45,STATE_RESTRICTED:50,STATE_DISCARD:90,STATE_DEL:100,STATE_DONE:100,STATE_PLAN_PUBLIC:0,STATE_PLAN_PRIVATE:70,STATE_ATTR_VERIFY:10,STATE_ATTR_VERIFY_INIT:20,STATE_ATTR_VERIFY_WAIT:30,STATE_ATTR_VERIFY_DONE:40,ACTION_EMAIL:1,ACTION_SMS:2,ACTION_PUSH:3,ACTION_MACRO:4,ACTION_WEBHOOK:5,ACTION_SLACK:6,ACTION_DISCORD:7,ACTION_LOCAL_AUDIO:101,ACTION_LOCAL_POPUP:102,ACTION_LOCAL_OPEN_TAB:103,RUN_STATE_INIT:1,RUN_STATE_WAIT:2,RUN_STATE_WIP:3,LOCAL_STATE_SYNCED:0,LOCAL_STATE_POST:1,LOCAL_STATE_PUT:2,LOCAL_STATE_DEL:3,CLIENT_FF:10,CLIENT_CR:11,CLIENT_OP:12,CLIENT_FFWX:13,CLIENT_MSE:14,CLIENT_MAC:20,CLIENT_WEBFF:50,CLIENT_DEDI:51,CLIENT_ANY:"eeeeeeee-eeee-eeee-eeee-eeeeeeeeeeee",CLIENT_WEB:"ffffffff-ffff-ffff-ffff-ffffffffffff",SOURCE_SITEMAP:1,TIME_INFINITE:2592e3}},13:function(e,t,r){"use strict";var n=r(5),o=r(33);const s=window._;if(!s)throw new Error("ADD _");const i=window.Backbone;if(!i)throw new Error("ADD Backbone");function a(e,t,r){if(!n.a.api)return void n.a.on("init",(function(){a(e,t,r)}));const o=s.result(t,"url")||c();let i=r.data;null!=i||!t||"create"!==e&&"update"!==e&&"patch"!==e||(i=r.attrs||t.toJSON(r));const u=r.xhr=n.a.api(o,e,i,(function(e,t){e?r.error&&r.error(e):r.success&&r.success(t)}));return t.trigger("request",t,u,r),u}var c=function(){throw new Error('A "url" property or function must be specified')};const u=i.Model.prototype.fetch;i.Model.prototype.fetch=async function(e){return e||(e={}),new Promise((t,r)=>{u.call(this,{error:function(...t){e.error&&e.error(...t),r(t)},success:function(...r){e.success&&e.success(...r),t(r)}})})},i.Model.prototype.clone=function(){const e=this.toJSON(),t=new this.constructor(e,{parse:!0});return t.props=s.clone(this.props),t};const l=i.Model.extend({sync:a,encodedFields:[],parse:function(e){return s.each(this.encodedFields,(function(t){const r=e[t];if(s.isString(r)){let n=null;try{n=JSON.parse(r)}catch(e){console.error("Invalid model json attribute:",t,r,e)}e[t]=n}})),e},prop:function(e,t){if(this.props||(this.props={}),2!=arguments.length)return s.result(this.props,e);{const r=s.result(this.props,e);if(r===t)return;this.props[e]=t,this.trigger("prop:"+e,t,r),this.collection&&this.collection.trigger("prop:"+e,t,r,this)}},toJSON:function(){const e=i.Model.prototype.toJSON.call(this);return s.each(this.encodedFields,(function(t){const r=e[t];s.isEmpty(r)||(e[t]=JSON.stringify(r))})),e}});t.a={sync:a,syncBatch:function(e,t){const r=s.map(e.dels,(function(e){return{method:"DELETE",url:s.result(e,"url")||c()}})),o=s.map(e.posts,(function(e){return{method:"POST",url:s.result(e,"url")||c(),body:e.toJSON()}})),i=s.map(e.puts,(function(e){return{method:"PUT",url:s.result(e,"url")||c(),body:s.pick(...[e.toJSON()].concat(s.keys(e.changedAttributes())))}})),a=[].concat(r,o,i);return 0!=a.length&&(DBG&&console.log("syncBatch: requests:",a),n.a.batch(a,t))},Model:l,Collection:i.Collection.extend({model:l,parse:function(e){return e.data},sync:a}),PagedCollection:o.a.requestPager.extend({model:i.Model.extend(),paginator_core:{},paginator_ui:{currentPage:0,perPage:2},server_api:{_opt:function(){return{limit:this.perPage,offset:this.currentPage*this.perPage}}},parse:function(e){return this.offset=e.offset,this.totalPages=Math.ceil(e.count/this.perPage),this.totalRecords=e.total_count,e.data}})}},30:function(e,t,r){"use strict";var n=r(13);r(1);const o=n.a.Model.extend(),s=n.a.Collection.extend({model:o}),i=n.a.Model.extend({parse:function(e){return e.entries=new s(e.entries),e}});t.a={Feed:i,FeedEntry:o,FeedEntryCollection:s}},31:function(e,t,r){"use strict";var n=r(4);if(!window.domo)throw new Error("ADD domo");if(!window.async)throw new Error("ADD async");const o=n.a.Base.extend({name:"FeedEntry",render:function(){const e=this.model.attributes;let t;return this.$el.append(H3(A({href:e.link},e.title)),DIV({style:"color: #999; margin: -10px 0px;"},I(moment(e.date).format("MMMM DD, YYYY"))),t=DIV({class:"summary"})),$(t).html(e.description||e.summary||""),this}}),s=n.a.Collection.extend({name:"FeedEntryList",addOne:function(e){const t=new o({parent:this,model:e}).render();return this.$el.append(t.el),t}}),i=n.a.Base.extend({name:"Feed",render:function(){const e=this.model.attributes;return this.$el.append(H3(A({href:e.link},e.title)),DIV(e.description||e.summary||""),new s({parent:this,collection:this.model.get("entries")}).render().el),this}});t.a={Feed:i,FeedEntry:o,FeedEntryList:s}},33:function(e,t,r){"use strict";var n=r(5);const o=window.Backbone;if(!o)throw new Error("ADD Backbone");const s=window._;if(!s)throw new Error("ADD _");const i=window.jQuery;if(!i)throw new Error("ADD jQuery");const a={version:"0.6.0"};a.requestPager=o.Collection.extend({sync:function(e,t,r){const o=this,i=r.data||{},a=s.result(t,"url");o.setDefaults();const c={};s.each(s.result(o,"server_api"),(function(e,t){s.isFunction(e)&&(e=e.call(o)),c[t]=e})),i._opt=s.extend(c._opt||{},i._opt),s.extend(c,i);const u=n.a.api(a,e,c,(function(e,t){e?r.error&&r.error(e):r.success&&r.success(t)}));return t&&t.trigger&&t.trigger("request",t,u,r),u},setDefaults:function(){const e=this;s.defaults(e.paginator_ui,{firstPage:0,currentPage:1,perPage:5,totalPages:10,pagesInRange:4}),s.each(e.paginator_ui,(function(t,r){s.isUndefined(e[r])&&(e[r]=e.paginator_ui[r])}))},requestNextPage:function(e){const t=this.info();if(!(t.currentPage+1>=t.totalPages)){if(void 0!==this.currentPage)return this.currentPage+=1,this.pager(e);{const e=new i.Deferred;return e.reject(),e.promise()}}e.error&&e.error("Cannot go past last page")},requestPreviousPage:function(e){if(!(this.currentPage<=0)){if(void 0!==this.currentPage)return this.currentPage-=1,this.pager(e);{const e=new i.Deferred;return e.reject(),e.promise()}}e.error&&e.error("Cannot go before first page")},goTo:function(e,t){if(void 0!==e)return this.currentPage=parseInt(e,10),this.pager(t);{const e=new i.Deferred;return e.reject(),e.promise()}},howManyPer:function(e){void 0!==e&&(this.currentPage=this.firstPage,this.perPage=e,this.pager())},info:function(){const e={totalRecords:this.totalRecords||0,currentPage:this.currentPage,firstPage:this.firstPage,totalPages:Math.ceil(this.totalRecords/this.perPage),lastPage:this.totalPages,perPage:this.perPage,previous:!1,next:!1};return this.currentPage>1&&(e.previous=this.currentPage-1),this.currentPage<e.totalPages&&(e.next=this.currentPage+1),e.hasNext=e.next,e.hasPrevious=e.next,e.pageSet=this.setPagination(e),this.information=e,e},setPagination:function(e){const t=[];let r=0,n=0;const o=2*this.pagesInRange,s=Math.ceil(e.totalRecords/e.perPage);if(s>1)if(s<=1+o)for(r=1,n=s;r<=n;r++)t.push(r);else if(e.currentPage<=this.pagesInRange+1)for(r=1,n=2+o;r<n;r++)t.push(r);else if(s-this.pagesInRange>e.currentPage&&e.currentPage>this.pagesInRange)for(r=e.currentPage-this.pagesInRange;r<=e.currentPage+this.pagesInRange;r++)t.push(r);else for(r=s-o;r<=s;r++)t.push(r);return t},pager:function(e){return this.fetch(e||{})},bootstrap:function(e){return s.extend(this,e),this.setDefaults(),this.info(),this}}),a.requestPager.prototype.nextPage=a.requestPager.prototype.requestNextPage,a.requestPager.prototype.prevPage=a.requestPager.prototype.requestPreviousPage,t.a=a},46:function(e,t,r){"use strict";r.r(t);var n=r(3),o=r(1),s=(r(16),r(2)),i=r(4),a=r(30),c=r(31);const u=window._;if(!u)throw new Error("ADD _");const l=window.qs;if(!l)throw new Error("ADD qs");if(!window.domo)throw new Error("ADD domo");const p=window.async;if(!p)throw new Error("ADD async");t.default=function(){let e;const t=l.parse(location.search.substring(1)).url,r=new(i.a.RoutedRoot.extend({name:"Root",actions:{add:{fn:"action_add"}},action_add:function(){s.a.start("save",{info:"l_saving"}),n.a.store.SieveStore.create({content_type:o.a.TYPE_FEED,name:e?e.attributes.title:"Untitled",uri:e?e.attributes.link:t,config:JSON.stringify({uri:t}),schedule:JSON.stringify({type:"INTERVAL",params:{interval:1800}}),state:o.a.STATE_READY},(function(e,t){e?s.a.stop("save",{error:"Failed to add item due to error:"+(e.message||e.msg)}):(s.a.stop("save"),p.series([function(e){n.a.store.ActionStore.create({sieve_id:t.id,type:101},e)},function(e){n.a.store.ActionStore.create({sieve_id:t.id,type:102},e)}],(function(e){location.href="/ui/inbox.html"})))}))}}))({el:document.body});function f(e,t){s.a.reset(),0==t.length?s.a.error("No feed found in page."):1==t.length?location.href="/ui/feed.html?url="+t[0].href:$("#list").empty().append(H4("Found multiple feeds in the page:")).append(u.map(t,(function(e){return H5(A({href:"/ui/feed.html?url="+e.href},e.title))}))).append(H5("Click link to view a feed. Once loaded, you can add it to your watchlist."))}function d(t,n){console.log("Feed fetch result:",t,n),s.a.reset(),t?s.a.error("Reload page to try later. Failed to fetch feed content."):(e=new a.a.Feed(n,{parse:!0}),$('[data-action="add"]').removeClass("hide"),new c.a.Feed({el:$("#feed")[0],model:e,parent:r}).render())}r.updateActions(),t?n.a.HTTP.get({url:t},(function(e,r,o){let i=o.getResponseHeader("content-type");switch(console.log("content:",i,r),i=i.split(";")[0]){case"text/html":case"application/xhtml+xml":var a=new DOMParser,c=a.parseFromString(r,i);if(console.log("html:",c),!c){const e=r.match(/<link.*\/>/gim).join("");console.log("fragment:",e),c=a.parseFromString(e,i)}console.log("html:",c),function(e,t,r){if(!t)return r({code:"NULL",msg:"HTML document is null"});const n=t.querySelectorAll('link[type="application/rss+xml"],link[type="application/atom+xml"]'),o=u.map(n,(function(t){let r=t.getAttribute("href");return"/"==r[0]&&(r=new URL(e).origin+r),{title:t.getAttribute("title"),href:r}}));console.log("Feeds found:",o),r(null,o)}(t,c,f);break;case"application/xml":case"text/xml":case"application/rss+xml":case"application/atom+xml":n.a.Feed.fromString(o.responseText,t,d);break;default:s.a.error("Unknown content type:"+i)}})):console.error("Invalid url parameter, cannot get feed for the page.")}},5:function(e,t,r){"use strict";const n=window._;if(!n)throw new Error("ADD _");function o(e){n.extend(this,e,this.parse(e.path))}function s(e){this.routes=n.map(e.routes,(function(e){return new o(e)}),this)}function i(e){try{return decodeURIComponent(e)}catch(t){return e}}n.extend(o.prototype,{match:function(e){const t=this.keys,r=this.params={},n=this.regexp.exec(e);if(!n)return!1;for(let o=1,s=n.length;o<s;++o){const s=t[o-1],a="string"==typeof n[o]?i(n[o]):n[o];if(!s)throw new Error("Nameless param not supported, path:"+e);r[s.name]=a}return!0},parse:function(e){const t=[];return e=e.concat("").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,(function(e,r,n,o,s,i,a){return t.push({name:o,optional:!!i}),r=r||"",(i?"":r)+"(?:"+(i?r:"")+(n||"")+(s||n&&"([^/.]+?)"||"([^/]+?)")+")"+(i||"")+(a?"(/*)?":"")})).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),{keys:t,regexp:new RegExp("^"+e+"$","i")}}}),n.extend(s.prototype,{find:function(e){return n.find(this.routes,(function(t){return t.match(e)}))}});var a=s,c=r(1),u=r(3);if(!window.qs)throw new Error("ADD qs");if(!window.jQuery)throw new Error("ADD jQuery");const l=window._;if(!l)throw new Error("ADD _");const p=window.async;if(!p)throw new Error("ADD async");const f={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"},d={version:"0.0.1",api:(h=T,function(...e){if("function"!=typeof e[e.length-1])return new Promise((t,r)=>{h(...e,(function(e,n){e?r(e):t(n)}))});h(...e)}),batch:function(e,t){p.mapSeries(e,(function(e,t){T(e.url,e.method,e.body,(function(r,n){r&&console.error("Error handling request:",e),t(r,n)}))}),t)},init:function(e){e()}};var h;const E=new a({routes:[{list:!0,path:"/clients",store:u.a.store.ClientStore},{path:"/clients/:id",store:u.a.store.ClientStore},{list:!0,path:"/sieves",store:u.a.store.SieveStore},{path:"/sieves/:id",store:u.a.store.SieveStore},{list:!0,path:"/sieves/:sieve_id/actions",store:u.a.store.ActionStore},{path:"/sieves/:sieve_id/actions/:id",store:u.a.store.ActionStore},{list:!0,path:"/sieves/:sieve_id/data",store:u.a.store.SieveDataProxy},{path:"/sieves/:sieve_id/data/:id",store:u.a.store.SieveDataStore},{list:!0,path:"/sieves/:key/works/local",store:u.a.store.WorkStore},{list:!0,path:"/rules",store:u.a.store.RuleStore},{path:"/rules/:id",store:u.a.store.RuleStore},{list:!0,path:"/tags",store:u.a.store.TagStore},{list:!0,path:"/tags/:id",store:u.a.store.TagStore},{list:!0,path:"/users/attrs",store:u.a.store.AttrStore},{path:"/users/attrs/:id",store:u.a.store.AttrStore}]});function T(e,t,r,n){"function"==typeof t?(n=t,r=null,t="GET"):"function"==typeof r&&(n=r,l.isObject(t)?(r=t,t="GET"):r=null);r=r||{},t=f[t]||t||"GET";delete r._state;const o=E.find(e);return o?function(e,t,r,n){const o=e.path,s=e.store,i=s.hasField("user_id"),a=window.USER?USER.id:u.a.auth.getId(),p=function(e,r){e?console.error("API:err",o,t,e):"GET"!=t&&u.a.service.syncStore(s),r&&(r=JSON.parse(JSON.stringify(r))),n(e,r)};switch(t){case"DELETE":s.update(e.params,{state:c.a.STATE_DEL,_state:c.a.LOCAL_STATE_DEL},p);break;case"GET":var f=e.params;if(i&&(f.$and={$or:[["user_id",a],["user_id",null]]}),e.list){const e=r._opt;f=l.extend(l.omit(r,"_opt"),f),s.find(f,e,p)}else s.findOne(f,p);break;case"PATCH":case"PUT":f=e.params;var d=r;s.update(f,d,p);break;case"POST":d=l.extend(r,e.params);s.create(d,p);break;default:p({msg:"API: Unknown method:"+t})}}(o,t,r,n):u.a.api(e,t,r,n)}t.a=d}}]);
//# sourceMappingURL=11.js.map