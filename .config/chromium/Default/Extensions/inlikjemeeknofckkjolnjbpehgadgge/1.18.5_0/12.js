(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{10:function(e,t,i){"use strict";var n=i(12),o=i(0);const a=window._;if(!a)throw new Error("ADD _");t.a=function(e){let t=a.toArray(arguments).slice(1);return t=a.map(t,(function(e){return a.isString(e)?Object(o.a)(e):e})),n.a.sprintf(...[Object(o.a)(e)].concat(t))}},36:function(e,t,i){"use strict";var n=i(10),o=(i(2),i(4)),a=i(6);if(!window.jQuery)throw new Error("ADD jQuery");if(!window._)throw new Error("ADD _");if(!window.Backbone)throw new Error("ADD Backbone");if(!window.domo)throw new Error("ADD domo");const s=o.a.Base.extend({name:"SieveConstraints",postInit:function(){},render:function(){const e=this.options.url||"";return this.$el.empty().append(DIV({class:"xmonitor-limit"},DIV({class:"alert alert-danger"},Object(n.a)("m_monitor_constraint_1",this.model.count,this.model.limit)," ",Object(n.a)("m_monitor_constraint_2"),UL(LI(A({href:a.a.agents.local?"/ui/inbox.html":"/watchlist"},I({class:"fa fa-link"})," ",Object(n.a)("a_go_to_watchlist")),": ",Object(n.a)("m_monitor_constraint_3")),LI(A({href:e+"/settings/billing"},I({class:"fa fa-link"})," ",Object(n.a)("a_go_to_billing")),": ",Object(n.a)("m_monitor_constraint_4")))))),this}});t.a=s},38:function(e,t,i){"use strict";var n=i(3),o=i(0),a=i(4),s=i(2);if(!window.domo)throw new Error("ADD domo");const r=window.jQuery;if(!r)throw new Error("ADD jQuery");const c=window._;if(!c)throw new Error("ADD _");const l=window.Backbone;if(!l)throw new Error("ADD Backbone");a.a.Base.extend({name:"LoginView",getCredentials:function(e){return{user:this.form.id.value,password:this.form.password.value}[e]},postInit:function(e={}){const t=this;this.model=new l.Model({name:USER.name||""}),window.addEventListener("message",e=>{"event"==e.data.type&&this.trigger("frame:"+e.data.data)}),this.on("frame:ready",()=>{console.log("frame:ready"),r(".xloading").remove(),r(".xdevice-manager").show(),this.postMessage({type:"request",data:{action:"login",name:t.getCredentials("user"),password:t.getCredentials("password")}})}),this.on("frame:done",()=>{this.saveToken()}),this.on("frame:cancel",()=>{r(".xlogin").show(),r(".xdevice-manager").remove()})},postMessage:function(e){this.iframe.contentWindow.postMessage(e,n.a.CFG.URL.ROOT)},events:{submit:"submit"},showErrMsg(e){switch(e.status){case 400:return Object(o.a)("e_auth_400");case 403:return Object(o.a)("e_auth_403");case 402:return Object(o.a)("e_auth_402");default:return Object(o.a)("e_auth_5xx")}},saveToken:function(){const e={name:this.form.id.value,password:this.form.password.value};c.isEmpty(e.name)||c.isEmpty(e.password)?s.a.error(Object(o.a)("e_auth_400")):(this.$(".xsubmit").button("loading"),n.a.auth.saveToken(e,e=>{this.$(".xsubmit").button("reset"),e?(console.error("checkLogin:err?",e),s.a.error(this.showErrMsg(e)),402==e.status&&this.renderLoading()):(s.a.reset(),this.options.onLogin())}))},submit:function(e){e.preventDefault(),this.saveToken()},getMargin:function(){return this.options.isPopup?"40px":"100px"},showHeader:function(){return this.options.isPopup?"hide":""},getStyle:function(){return this.options.isPopup?"display:block;":`box-shadow: 5px 5px 10px #999; margin: auto;\n        margin-top: ${this.options.isPopup?"0px":"100px"};\n        overflow:hidden; max-width: 600px;`},renderLoading:function(){r(".xlogin").hide(),this.$el.append(DIV({class:"xloading",style:"margin: 50% auto; font-size: 3em; text-align: center;"},I({class:"fa fa-spin fa-spinner"})," ",Object(o.a)("l_loading"))),this.renderDevice(),r(".xdevice-manager").hide()},renderDevice:function(){const e=this.options.isPopup?"100vh":"calc(90vh - 100px)";this.$el.append(DIV({class:"xdevice-manager",style:`${this.getStyle()}`},this.iframe=IFRAME({src:n.a.CFG.URL.ROOT+"/frame-devices",style:`\n          width: 100%;\n          height: ${e};\n          margin-top: ${e};\n          transition: margin-top 300ms ease\n          `,frameborder:"none"}))),setTimeout(()=>this.iframe.style.marginTop=0,300)},render:function(){return this.$el.empty().append(DIV({class:`xpopup-heading xheader xheader-ext ${this.showHeader()}`,style:"width: 300px; margin: auto"},H2({class:"text-center"},Object(o.a)("a_signin"))),this.form=FORM({class:"xlogin",style:"width: 300px; margin: auto"},DIV({class:"xdistill-icon-container",style:`\n          margin-top: ${this.getMargin()};`},IMG({src:"ui/img/distill_128.png",style:"\n          display:block;\n          margin: auto;\n          border: solid 1px #ccc;\n          width: 150px;\n          height: 150px;\n          padding: 15px;\n          border-radius: 50%;\n          background-color: #fff;\n          box-shadow: 0px 3px 8px #aaa, inset 0px 2px 3px #fff;\n          background-image: -webkit-gradient(linear, left top, left bottom, from(#f7f7f7), to(#e7e7e7));\n          background-image: -webkit-linear-gradient(top, #f7f7f7, #e7e7e7); ",title:"Distill"})),DIV({style:"margin-top: 50px;"},A({class:"xurl btn btn-primary btn-block",style:"margin-left: 10px;",href:`${n.a.CFG.URL.ROOT}/service-login?redirect=app://ui/inbox.html#inbox`},Object(o.a)("a_login"))),DIV({style:"margin-top: 20px;"},A({class:"xurl btn btn-default btn-block",style:"margin-left: 10px;",href:`${n.a.CFG.URL.ROOT}/register`},Object(o.a)("a_register"))),DIV({class:"text-center",style:"margin-top: 25px"},A({class:"xurl",href:`${n.a.CFG.URL.ROOT}/account/forgot_password`},Object(o.a)("a_forgot_pass"))))),this.focus(),this}})},50:function(e,t,i){"use strict";i.r(t);var n=i(51),o=i(0),a=i(3),s=i(4),r=i(2);i(38);if(!window.domo)throw new Error("ADD domo");const c=window.async;if(!c)throw new Error("ADD async");const l=window._;if(!l)throw new Error("ADD _");const d=window.jQuery;if(!d)throw new Error("ADD jQuery");var u={Preview:s.a.ActionProvider.extend({name:"Preview",getConfig:function(){return JSON.parse(this.tpl.sieve_config)},getPreview:function(){const e=this,t=this.loader,i=this.getConfig().selections[0].frames;c.mapSeries(i,(function(e,i){t.port_request(e.index,{path:"getText",data:{includes:e.includes,excludes:e.excludes}},i)}),(function(t,i){if(t)console.error("err",t),d(e.elPreview).text(JSON.stringify(t));else{const t=i.join("\n");l.delay((function(){d(e.elPreview).text(t)}),200)}}))},load:function(e,t){this.tpl=e,this.loader=t,this.render(),this.setParent(this.options.parent),t.rootPort&&t.rootPort.ready?(d(this.elPreview).append(Object(o.a)("l_loading"),"..."),this.getPreview()):(d(this.elPreview).append(Object(o.a)("l_waiting"),"..."),this.listenTo(t,"load:root",this.getPreview))},render:function(){let e;return this.$el.empty().append(DIV({class:"xsection xheader"},H3(Object(o.a)("l_preview"),e=A({class:"close pull-right"},"✕"))),DIV({class:"xsection"},H4(this.tpl.desc_name),P({style:"margin: 10px 0;"},this.tpl.desc_info)),DIV({class:"xsection"},this.elPreview=PRE({style:""}))),e.onclick=this.remove,this}}),Vote:s.a.ActionProvider.extend({name:"Vote",actions:{submit_vote:{fn:"action_submit"}},action_submit:function(){const e=this;a.a.api("/votes","POST",{topic:"tpls:new",source:this.loader.rootPort.uri,client_type:a.a.CFG.CLIENT.TYPE,data:this.data,note:this.$(".xnote").val()},(function(t,i){e.showVotedMsg()}))},checkVote:function(){const e=this;this.$el.empty().append(DIV({class:"xsection"},Object(o.a)("l_loading"))),a.a.api("/votes","GET",{source:this.loader.rootPort.uri},(function(t,i){e.render(),i.count>0&&e.showVotedMsg()}))},load:function(e){this.data=null,this.loader=e,e.rootPort&&e.rootPort.ready?this.loadData():this.listenTo(e,"load:root",this.loadData),this.checkVote(),this.setParent(this.options.parent)},loadData:function(){const e=this;this.loader.port_request(0,{path:"getHTML",data:{includes:[{type:"css",expr:"body"}],excludes:[]}},(function(t,i){t?(console.error("error getting data: ",t),e.data=i):(e.data=i,e.trigger("data"))}))},render:function(){let e;return this.$el.empty().append(DIV({class:"xsection xheader"},H3("Vote Page",e=A({class:"close pull-right"},"✕"))),this.elContent=DIV(DIV({class:"xsection"},"Please add a brief comment about the content to be monitored in the page. If you have any other comment, feel free to add that as well."),DIV({class:"xsection"},this.elComment=TEXTAREA({class:"form-control xnote",placeholder:"Comment",style:"height: 100px;"})),DIV({class:"xsection"},BUTTON({class:"btn btn-primary btn-block","data-action":"submit_vote"},"Submit Vote")))),e.onclick=this.remove,this.focus(),this},showVotedMsg:function(){d(this.elContent).empty().append(H4({class:"xsection"},"Thank you for voting!"),DIV({class:"xsection"},"Once we review this submission and add a template, it should appear under suggestion.")),l.delay(this.remove,4e3)}})},p=i(36),h=i(52);if(!window.domo)throw new Error("ADD domo");const f=window.async;if(!f)throw new Error("ADD async");const m=window._;if(!m)throw new Error("ADD _");const g=window.jQuery;if(!g)throw new Error("ADD jQuery");if(!window.Backbone)throw new Error("ADD Backbone");g("body").removeClass("hide");const w=T(),x='document.querySelectorAll(\'[type="application/rss+xml"],[type="application/atom+xml"]\').length';let b,v,y;const _=new s.a.RoutedRoot,D=new u.Preview({parent:_}),O=new u.Vote({parent:_});let k;function I(){D.remove(),O.remove(),v&&v.destroy(),v=null,b=null}function C(){g(".xminilist").removeClass("hide"),g(".xdetail").addClass("hide"),g(".xsuggestions .xitem.xactive").removeClass("xactive")}function L(){g(".xbody").removeClass("hide"),g(".xfeed").prop("disabled",!0).removeClass("btn-primary"),g(".xsel").addClass("btn-primary"),/^http/.exec(b.url)&&(a.a.createLoader({type:"tab",info:{tabId:b.id},pageMods:["locator"]},(function(e,t){v=t})),function(){try{a.a.chrome.tabs.executeScript(b.id,{allFrames:!1,code:x},(function(e){e&&e[0]>0&&(g(".xfeed").prop("disabled",!1).addClass("btn-primary").fadeTo(10,.3,(function(){g(this).fadeTo(600,1)})),g(".xsel").removeClass("btn-primary").addClass("btn-default"))}))}catch(e){}}()),function(){if(g(".xsuggestions").empty(),!a.a.auth.getToken())return void g(".xsuggestions").empty().append(LI(DIV({class:"xsection"},"A template is a ready to use config to help add monitors quickly that works reliably. ","Sign in to your account to get started. "),DIV({class:"xsection"},A({class:"btn btn-default btn-slim btn-block xurl",href:a.a.service.serviceLoginUrl},Object(o.a)("a_signin")))));if(!/^http/.exec(b.url))return void g(".xsuggestions").append(DIV({class:"xsection"},P("Unsupported URL")));a.a.api("/tpls/sieves/search","GET",{url:b.url},(function(e,t){var i;e?renderTemplatesError():0==t.count?g(".xsuggestions").empty().append(LI(DIV({class:"xsection"},"No template found for current tab. "))):(i=t.data,y=i,lis=m.map(y,(function(e){return LI(DIV({class:"xitem xtpl xread xbtn-add-tpl","data-id":e.id},A({"data-toggle":"tooltip","data-title":"Click to add monitor",href:"#"},e.desc_name)))})),g(".xsuggestions").empty().append(lis),g(".xsuggestions [data-toggle=tooltip]").tooltip())}))}(),j(),E(),C()}function j(){a.a.store.SieveStore.find({"state.in":[40,45],"id.ne":null},{limit:40,order:["-ts_data"],only:["id","name","uri","text","ts_data","ts_view","err"]},(function(e,t){const i=g("#update-list").empty();if(e)i.text("Error getting updates:",JSON.stringify(e));else if(k=t,0==t.count)i.append(DIV({class:"xsection"},Object(o.a)("m_popup_empty")," ",A({class:"xurl",href:a.a.CFG.URL.WELCOME},Object(o.a)("l_get_started"))));else{const e=m(t.data).chain().sortBy((function(e){const t=new Date(e.ts_data).valueOf();return-(t-new Date(e.ts_view).valueOf()>0?2:1)*t})).map((function(e){const t=JSON.parse(e.err||null);return LI(DIV({class:"xitem "+(e.ts_view>e.ts_data?"xread":"")},A({href:"#",id:e.id,class:"nowrap xsieve"},e.name),t?DIV({class:"small error"},(t.code||"EUNKNOWN")+" error encountered"):DIV({class:"small"},e.text)))})).value();i.append(e),g(".xlist-count .xvisible").text(t.count)}}))}function E(){g(".btn-toggle > .btn").removeClass("active"),a.a.isActive()?(g("#btn-on").addClass("active"),g("#btn-off").removeClass("btn-danger")):g("#btn-off").addClass("btn-danger active")}async function V(){let e;const t=DIV({class:"xsection xheader"},H3(Object(o.a)("m_monitor_limit"),e=A({class:"close pull-right"},"X"))),i=DIV({style:"height: 100%; background-color: #FFF; z-index: 100;"},t,DIV({class:"constraintContainer",style:"margin: auto"}));g(".xbody").children().hide(),g(".xbody").append(i),g(".constraintContainer").append(new p.a({model:await T(),url:a.a.CFG.URL.ROOT}).render().el),g(".xbody").on("click","a",(function(){return chrome.tabs.create({url:g(this).attr("href")}),!1})),e.onclick=()=>{g(i).remove(),g(".xbody").children().show()}}async function T(e=1){const t={isOverLimit:!1,isFlexi:!1},i=a.a.auth;if(i&&!i.isLoggedIn()){if(i.isLegacy())return t;{const i=25,{total_count:n}=await a.a.store.SieveStore.find({"state.in":[40,45]},{only:["id"],limit:1});return{...t,limit:i,count:n,isOverLimit:n+e>i}}}const n=await a.a.api("/users/sieve-count");return{...n,isOverLimit:!n.isFlexi&&n.count+e>n.limit}}D.on("remove",C),O.on("remove",C),window.hidePopup=function(){close()},window.onunload=I,r.a.reset(),g("body").on("click",".xbtn-add-tpl",(async function(e){let t;try{t=await w}catch(e){console.error(e),t={isOverLimit:!1}}if(t.isOverLimit)V();else{const t=e.currentTarget.dataset.id;a.a.addSieveForTemplate(b,t),hidePopup()}})),g("body").on("click",".xsieve",(function(e){const t=e.target.id;a.a.service.openAndMarkRead(t,(function(e,t){e?alert("Failed to show monitor"):hidePopup()})),e.preventDefault()})).removeClass("hide"),g("body").on("click",".xurl",(function(e){a.a.chrome.tabs.create({url:e.target.href}),e.preventDefault(),hidePopup()})).removeClass("hide"),g(".xfeed").click((async function(){let e;try{e=await w}catch(t){console.error(t),e={isOverLimit:!1}}e.isOverLimit?V():a.a.addFeedForTab((function(e){e?alert(e.msg||e.message||e):m.delay(hidePopup,50)}))})),g(".xinbox").click((function(){a.a.service.showWatchlist(),hidePopup()})),g(".xsel").click((async function(){let e;try{e=await w}catch(t){console.error(t),e={isOverLimit:!1}}e.isOverLimit?V():(I(),a.a.openSelector(),hidePopup())})),g(".xwatch").click((async function(){let e;try{e=await w}catch(t){console.error(t),e={isOverLimit:!1}}e.isOverLimit?V():a.a.watchTab((function(e,t){a.a.chrome.tabs.create({active:!0,url:a.a.service.appUrl+"#edit/"+t.id},(function(e){hidePopup()}))}))})),g(".xtoggle").click((function(e){a.a.service.toggleService(),E()})),g(".xmarkread").click((function(){a.a.service.markRead(j)})),g(".xrefresh").click((function(){function e(){a.a.service.Scheduler.isBusy()?m.delay(e,2e3):g(".xrefresh i").removeClass("fa-rotate-right fa-spin")}g(".xrefresh i").addClass("fa-rotate-right fa-spin"),a.a.store.SieveStore.find({state:40,client_id:a.a.store.Prefs.get("client.id")},{only:["id"],limit:1e3},(function(t,i){t||a.a.service.checkNow(m.pluck(i.data,"id")),m.delay(e,2e3)}))})),g(".xopenintab").click((function(){a.a.store.SieveStore.find({"state.in":[40,45],"ts_view.lt":{type:"field",name:"ts_data"}},{order:["-ts_data"],only:["id"]},(function(e,t){f.eachSeries(t.data,(function(e,t){a.a.service.openAndMarkRead(e.id,{openInBlank:!1},t)}),hidePopup)}))})),g(".xsuggestions").on("mouseenter",".xtpl",m.debounce((function(e){!function(e){const t=e.currentTarget.dataset.id;(function(e){const t=m.findWhere(y,{id:e});O.remove(),D.load(t,v),g(".xdetail").append(D.el)})(t),g(".xminilist").addClass("hide"),g(".xdetail").removeClass("hide"),g(".xsuggestions .xtpl.xactive").removeClass("xactive"),g(".xsuggestions .xtpl[data-id='"+t+"']").addClass("xactive")}(e)}),200)),g("[data-toggle=tooltip]").tooltip();t.default={init:function(e){Object(n.a)(),Object(h.a)({version:service.CFG.VERSION,id:USER.id}),r.a.reset(),b=e.tab,a.a.auth.isReady()?L():a.a.chrome.tabs.query({url:service.CFG.URL.ROOT+"/verify-email*"},e=>{if(0==e.length)a.a.chrome.tabs.create({url:a.a.service.serviceLoginUrl}),hidePopup();else{const t=e[0];a.a.chrome.tabs.update(t.id,{active:!0,url:a.a.service.serviceLoginUrl}),hidePopup()}})}}},51:function(e,t,i){"use strict";var n=i(0);const o=window.jQuery;if(!o)throw new Error("ADD jQuery");t.a=function(){o("[data-placeholder]").each((function(){this.placeholder=Object(n.a)(this.getAttribute("data-placeholder"))})),o("[data-text]").each((function(){this.textContent=Object(n.a)(this.getAttribute("data-text"))})),o("[data-title]").each((function(){this.title=Object(n.a)(this.getAttribute("data-title"))}))}},52:function(e,t,i){"use strict";let n;function o({url:e,...t}){n=e,window.addEventListener("unhandledrejection",(function(e){const i=e.reason;let n;s(n="object"==typeof i?{...i,...t}:{file_url:"",message:JSON.stringify(i),...t})})),window.onerror=function(e,i,n,o,a){if(e.toLowerCase().indexOf("script error")>-1);else{s({message:e,file_url:i,app_url:document.URL,line:n,column:o,stack:a.stack,...t})}return!1}}i.d(t,"a",(function(){return o}));const a=()=>{const e=new WeakSet;return(t,i)=>{if("object"==typeof i&&null!==i){if(e.has(i))return;e.add(i)}return i}};function s(e){fetch(n,{method:"POST",mode:"cors",body:JSON.stringify(e,a())}).then((function(e){})).catch((function(e){console.error("Request failure: ",e)}))}},6:function(e,t,i){"use strict";var n=i(3);t.a={user:1,email:1,phone:0,isSignedIn:function(){return null!=n.a.auth.getToken()},agents:{local:1,type:n.a.CFG.CLIENT.TYPE,version:n.a.CFG.VERSION},actions:{popup:!0},tabForDynamic:n.a.Supports.tabForDynamic,tabForXFrame:n.a.Supports.tabForXFrame}}}]);
//# sourceMappingURL=12.js.map