(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{49:function(e,t,n){"use strict";n.r(t);var o=n(51),i=n(1),s=n(8),r=n(0),a=(n(12),n(2),n(4)),c=n(11);n(18);var l=function e(t,n,o,i){const s=this;if(s==window||null==s)return new e(t,n,o,i);if("object"==typeof t)if(t.nodeType){const e=t.getBoundingClientRect();i=e.bottom-e.top,o=e.right-e.left,n=e.top,t=e.left}else i=t.height,o=t.width,n=t.top,t=t.left;this.x=function(){return t},this.y=function(){return n},this.width=function(){return o},this.height=function(){return i},this.add=function(s){const r=s.x(),a=s.y(),c=s.width(),l=s.height(),d=Math.min(t,r),h=Math.min(n,a),p=Math.max(r+c,t+o)-d,u=Math.max(a+l,n+i)-h;return new e(d,h,p,u)},this.area=function(){return o*i},this.clipTo=function(s){const r=s.x(),a=s.y(),c=s.width(),l=s.height(),d=f(r,t,r+c),h=f(a,n,a+l),p=f(r,t+o,r+c)-d,u=f(a,n+i,a+l)-h;return new e(d,h,p,u);function f(e,t,n){return t>e?t<n?t:n:e}},this.clone=function(){return new e(t,n,o,i)},this.move=function(s,r){return new e(t+s,n+r,o,i)},this.subtract=function(r){if(0==(r=r.clipTo(s)).area())return[s];const a=[],c=r.x(),l=r.y(),d=r.width(),h=r.height();let p,u,f,m;return p=t,u=n,(f=o)*(m=l-n)>0&&a.push(new e(p,u,f,m)),p=c+d,u=l,(f=t+o-(c+d))*(m=n+i-l)>0&&a.push(new e(p,u,f,m)),p=t,u=l+h,(f=c+d-t)*(m=n+i-l-h)>0&&a.push(new e(p,u,f,m)),p=t,u=l,(f=c-t)*(m=h)>0&&a.push(new e(p,u,f,m)),a},this.toString=function(){return"["+[t,n,o,i].join(", ")+"]"},this.toJSON=function(){return[t,n,o,i]}};const d=window._;if(!d)throw new Error("ADD _");a.a.ActionProvider.extend({className:"xmodal xoverview",name:"overview",close:function(){this.remove(),this.trigger("close")},initialize:function(e){a.a.ActionProvider.prototype.initialize.call(this,e),this.markers=e.markers,$(window).on("resize",this.render)},render:function(){const e=this;return setTimeout((function(){e.$el.empty(),e.$el.append(DIV({class:"xbg"}),DIV({class:"panel centered"})),e.contentRect=null,d.each(e.markers,e.renderMarker),e.renderButton()}),0),this},renderButton:function(){let e=100;this.options.btnTop?e=this.options.btnTop:this.contentRect&&(e=this.contentRect.y()+this.contentRect.height()+40);const t=A({class:"btn btn-primary xlarge"},Object(r.a)("a_get_set_go"));this.$(".panel").append(t).css({top:e}),$(t).click(this.close)},renderMarker:function(e){const t=e.pos,n=e.mark?l(e.mark):d.result(e,"rect");let o,i,s,r,a;if(!n)return;this.$el.append(o=DIV({class:"popover "+e.pos},DIV({class:"arrow"}),e.title?DIV({class:"popover-title"},e.title):I(),i=DIV({class:"popover-content"})),s=DIV({class:"xoutline"})),$(i).append(e.content),$(s).css({left:n.x(),top:n.y(),width:n.width(),height:n.height()});const c=$(o).outerWidth(),h=$(o).outerHeight();"top"==t||"bottom"==t?(r=Math.max(n.x()+n.width()/2-c/2,0),a="top"==t?n.y()-h:n.y()+n.height()):(r=Math.max(0,"left"==t?n.x()-c:n.x()+n.width()),a=n.y()+n.height()/2-h/2),$(o).css({left:r,top:a});const p=new l(r,a,c,h);this.contentRect=this.contentRect?this.contentRect.add(p):p}}),n(13);const h=window.jQuery;if(!h)throw new Error("ADD jQuery");const p=window._;if(!p)throw new Error("ADD _");if(!window.async)throw new Error("ADD async");if(!window.domo)throw new Error("ADD domo");if(!window.moment)throw new Error("ADD moment");if(!window.Backbone)throw new Error("ADD Backbone");const u=a.a.Base.extend({name:"SieveLocator",className:"row",onTypeChange:function(){this.model.set("type",this.selType.value),this.renderParams()},postInit:function(){this.model.on("change",this.updateDOM)},render:function(){let e;const t=p.map(s.a.LocatorDescList,(function(e){return OPTION({value:e.type},Object(r.a)(e.label))}));return this.$el.append(DIV({class:"col-md-2"},this.selType=SELECT({style:"margin:0 5px 0 0;width: auto;"})),DIV({class:"col-md-10"},e=DIV())),this.$elParams=h(e),h(this.selType).append(t).change(this.onTypeChange),this.updateDOM(),this},renderParams:function(){const e=this.$elParams,t=this.selType.value,n=p.findWhere(s.a.LocatorDescList,{type:t});e.empty();const o=p.map(n.params,(function(e){return c.a.create(e.type,{param:e,parent:this,model:this.model}).render().el}),this);e.append(o)},updateDOM:function(){this.selType.value=this.model.get("type"),this.renderParams()}});var f=a.a.Collection.extend({name:"SieveLocators",addOne:function(e){h(this.help).hide();const t=new u({model:e,parent:this});return this.list.appendChild(t.render().el),t},removeOne:function(){f.__super__.removeOne.apply(this,arguments),0==this.collection.length&&h(this.help).show()},renderBase:function(){this.$el.append(this.help=DIV({class:"info"},Object(r.a)("l_none")),DIV(this.list=DIV()))}});const m=a.a.Base.extend({name:"SieveConfigFrame",render:function(){const e=this.model.attributes;return this.$el.append(H5(e.index>0?"Selections in child frame "+e.index:""),DIV({class:"row"},LABEL({class:"col-md-2",style:"text-align:right"},Object(r.a)("l_el_selected")),DIV({class:"col-md-10"},(this.includes=new f({model:e.includes,parent:this,op:"INCLUDE"}).render()).el)),DIV({class:"row"},LABEL({class:"col-md-2",style:"text-align:right"},Object(r.a)("l_el_deselected")),DIV({class:"col-md-10"},(this.excludes=new f({model:e.excludes,parent:this,op:"EXCLUDE"}).render()).el))),this}}),g=a.a.Collection.extend({name:"SieveConfigFrames",addOne:function(e){const t=new m({model:e,parent:this});return this.$list.append(t.render().el),t},renderBase:function(){return this.$list=this.$el,this}}),w=a.a.Base.extend({name:"SieveConfigPage",render:function(){return this.frames=new g({model:this.model.get("frames"),parent:this}),this.$el.append(this.frames.render().el),this}}),x=a.a.Collection.extend({name:"SieveConfigPages",addOne:function(e){const t=new w({model:e,parent:this});return this.$list.append(t.render().el),t},renderBase:function(){this.$list=this.$el}});var y=a.a.Base.extend({name:"SieveConfigHTML",className:"form form-horizontal",postInit:function(e){y.__super__.postInit.call(this,e),this.pages=this.model.get("selections"),this.viewPages=new x({model:this.pages,parent:this}),this.regexpEditor=c.a.create("regexp",{param:{help:"h_regexp_filter",must:!1,name:"regexp",type:"regexp"},parent:this,model:this.model})},render:function(){return this.$el.append(this.help=DIV({class:"alert-info small",style:"padding: 4px 12px;margin-bottom: 4px;"},Object(r.a)("m_vs_help")),DIV({class:"row"},LABEL({class:"col-md-2",style:"text-align:right;"},Object(r.a)("l_text_filter")),DIV({class:"col-md-10"},this.regexpEditor.render().el)),this.viewPages.render().el),this},hideHelp:function(){this.model.isEmpty()?h(this.help).show():h(this.help).remove()}}),v={SieveConfigHTML:y},D=n(52);const _=window._;if(!_)throw new Error("ADD _");const b=window.jQuery;if(!b)throw new Error("ADD jQuery");const E=window.Backbone;if(!E)throw new Error("ADD Backbone");t.default=function(){Object(o.a)();const e=2,t=3,n=(r=1,function(){return r++});var r;const a=[];let c=!1;const l={};let d,h,p=new s.a.Sieve({},{parse:!0}),u=p.get("config"),f=u&&u.get("selections");const m=new s.a.SieveConfigHTML({selections:[],regexp:u?u.get("regexp"):void 0},{parse:!0});new v.SieveConfigHTML({el:b("#config")[0],model:m}).render();let g=!1;const w=chrome.runtime.connect({name:"selector:{}"});function x(e,t){if(t&&"program"===t.source)return;y(e.collection.frame.get("index"),{path:"picker_select_call",data:{method:"setLocator",id:e.id,args:[_.pick(e.attributes,"expr","type")]}},(function(e){e&&console.error("Failed to setLocator:",e),T()}))}function y(e,o,i){!function(e,o,i){const s=n();l[s]=i,w.postMessage({_id:s,type:t,path:e,data:o})}("loader/port_request",{portSelector:e,data:o},i)}function k(e,t){g=!1,t||(t=function(e){e&&console.error("ERR:SELECTOR:portReset:",e)}),L(e,(function(){y(e,{path:"picker_reset"},t)}))}function L(e,t){t||(t=function(e){e&&console.error("ERR:SELECTOR:portSetMode:",e)}),y(e,{path:"picker_setMode",data:g?"SELECT":"NOOP"},(function(n){t(n),g&&0==e&&!n&&I("Selector is on. Click elements on page that you woulld like to monitor for changes.")}))}function O(t){w.postMessage({type:e,data:t})}function S(){window.parent.postMessage({type:"show",data:{expanded:c}},"*"),O({type:"uistate",data:{expanded:c}}),b("#content")[c?"removeClass":"addClass"]("hide"),setTimeout(C,500)}function C(){b(".alert,textarea").show(),b(".alert,textarea").hide(),setTimeout((function(){b(".alert,textarea").show()}),100)}function I(e){y(0,{path:"showMsg",data:{msg:e}},(function(){}))}function T(){d&&(b("#preview").val("loading..."),async.mapSeries(d.get("frames"),(function(e,t){y(e.get("index"),{path:"getText",data:{includes:e.get("includes").toJSON(),excludes:e.get("excludes").toJSON()}},t)}),(function(e,t){if(e)console.error("error updating preview:",e),b("#preview").val(e.toString());else{const e=m.get("regexp");let n=t.join("");if(e&&e.expr){const t=n.match(new RegExp(e.expr,e.flags||""));n=t&&t.length>0?t.join(" "):""}b("#preview").val(n)}})))}function j(){const e=document.getElementById("a_expand_size"),t=document.getElementById("a_toggle_selection_mode").children[0];document.getElementsByTagName("body")[0];e.children[0].className=c?"fa fa-compress":"fa fa-expand",t.className=g?"fa fa-pause":"fa fa-play",S()}w.onMessage.addListener((function(n){const o=n.data;switch(n.type){case"load":p=new s.a.Sieve(o.model,{parse:!0}),u=p.get("config"),f=u&&u.get("selections"),u&&m.set("regexp",u.get("regexp")),g=!!o.state.selectorOn,c=!!o.state.expanded,j();break;case"loader:load":!function(e){const t=e.index,n=h&&h.get("frames").findWhere({index:t});a.push(t),y(t,{path:"require",data:["picker","pickerui"]},(function(e){e?console.error("ERR:Loading picker for port ",t,e):(n&&function(e){const t=e.get("index"),n=e.get("includes").models,o=e.get("excludes").models;n.length>0&&async.each(n,(function(e,n){y(t,{path:"picker_select_new",data:{locator:e.toJSON(),op:"INCLUDE"}},n)})),o.length>0&&async.each(o,(function(e,n){y(t,{path:"picker_select_new",data:{locator:e.toJSON(),op:"EXCLUDE"}},n)}))}(n),L(t))}))}(o);break;case"loader:reset":!function(e){const t=e.uri==p.get("uri"),n=m.get("selections");d=t&&n.at(0)||new s.a.Page(e,{parse:!0}),a.splice(0),n.reset([d]),h=f&&t&&f.at(0)}(o);break;case"loader:port:window:select:close":v=o,d.removeLocator(v.index,v.data.id),T();break;case"loader:port:window:select:display":!function(e){const t=d.getLocator(e.index,e.data.id),n=_.extend({id:e.data.id},e.data.locator);_.isEqual(n,t.attributes)||(t.set(n,{source:"program"}),T())}(o);break;case"loader:port:window:select:new":!function(e){const t=_.extend({id:e.data.id},e.data.locator),n=d.addLocator({index:e.index,title:e.title,uri:e.uri},e.data.op,t);E.listenTo(n,"change",x)}(o);break;case e:console.warn("Unhandled event: ",n);break;case t:console.error("Unhandled request: ",n),w.postMessage({_id:n._id,type:4,err:{msg:"Request not handled"}});break;case 4:var i=n._id,r=l[i];r?(delete l[i],r(n.err,n.data)):console.error("Unhandled response: ",n);break;default:console.warn("Unhandled msg type: ",n)}var v})),w.onDisconnect.addListener((function(){})),Object(D.a)({url:service.CFG.URL.ER,app:service.CFG.CLIENT.NAME,version:service.CFG.VERSION,id:USER.id}),j(),m.on("change:regexp",T),b("[action]").click((function(){const e=b(this).attr("action"),t=App[e];t?t():console.error("action not found",e,App)})),window.App={close:function(){async.each(a,k,(function(){O({type:"close"})}))},save:function(){if(m.isEmpty())return void I("Please select elements to monitor before saving selections.");p.set({name:d.get("title"),uri:d.get("uri"),config:m,content_type:i.a.TYPE_HTML});const e=p.toJSON();async.each(a,k,(function(){O({type:"save",data:e})}))},toggleExpanded:function(){c=!c,j()},toggleSelector:function(){g=!g,async.each(a,L),j()}}}},51:function(e,t,n){"use strict";var o=n(0);const i=window.jQuery;if(!i)throw new Error("ADD jQuery");t.a=function(){i("[data-placeholder]").each((function(){this.placeholder=Object(o.a)(this.getAttribute("data-placeholder"))})),i("[data-text]").each((function(){this.textContent=Object(o.a)(this.getAttribute("data-text"))})),i("[data-title]").each((function(){this.title=Object(o.a)(this.getAttribute("data-title"))}))}},52:function(e,t,n){"use strict";let o;function i({url:e,...t}){o=e,window.addEventListener("unhandledrejection",(function(e){const n=e.reason;let o;r(o="object"==typeof n?{...n,...t}:{file_url:"",message:JSON.stringify(n),...t})})),window.onerror=function(e,n,o,i,s){if(e.toLowerCase().indexOf("script error")>-1);else{r({message:e,file_url:n,app_url:document.URL,line:o,column:i,stack:s.stack,...t})}return!1}}n.d(t,"a",(function(){return i}));const s=()=>{const e=new WeakSet;return(t,n)=>{if("object"==typeof n&&null!==n){if(e.has(n))return;e.add(n)}return n}};function r(e){fetch(o,{method:"POST",mode:"cors",body:JSON.stringify(e,s())}).then((function(e){})).catch((function(e){console.error("Request failure: ",e)}))}}}]);
//# sourceMappingURL=14.js.map